@using STPC.DynamicForms.Web.RT.Helpers
@{
    var userModel = (STPC.DynamicForms.Web.RT.Models.LoginViewModel)ViewBag.userModel;
     
}

<!DOCTYPE html>
<html>

<head>
    @*<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />*@

    <title>@ViewBag.Title</title>

    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href="@Url.Content("~/Content/joinweb_style.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/fontawesome/font-awesome.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/webgrid.css")" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/jquery-ui-1.8.21.custom.css")" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/js/jsNotifications/ext/jboesch-Gritter/css/jquery.gritter.css")" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/style_dragAndDrop.css")" />
    @*<link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/Dialog/ui-lightness/jquery-ui-1.8.6.custom.css")" />*@
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/Dialog/jquery.dialogr.css")" />

    <link href="css/ui-lightness/jquery-ui-1.8.6.custom.css" rel="stylesheet" type="text/css" />
    <link href="css/jquery.dialogr.css" rel="stylesheet" type="text/css" />

    <script src="@Url.Content("~/Scripts/jquery-1.8.2.min.js")" type="text/javascript"></script>

    @*<script src="@Url.Content("~/Content/js/jsNotifications/ext/jquery-1.7.2.min.js")" type="text/javascript"></script>*@
    <script src="@Url.Content("~/Content/js/jsNotifications/ext/jboesch-Gritter/js/jquery.gritter.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/js/jsNotifications/jsNotifications.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/js/notifications-example.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/jquery.numeric.js")" type="text/javascript"></script>


    <script src="@Url.Content("~/Scripts/LiSimAbcGeneralJs.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui-1.9.0.min.js")" type="text/javascript"></script>
    @*<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>*@
    <script src="@Url.Content("/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("/Scripts/jquery.validate.unobtrusive.min.js")"/ type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/Forms/Respond.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/Forms/TimeOut.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/Forms/FormPageActions.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/Currency/jquery.formatCurrency-1.4.0.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/Currency/jquery.formatCurrency.es-CO.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.blockUI.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.toolTip.min.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/ui.dialogr.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/typeface-0.14.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/museo_700.typeface.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/scripts/jQuery.FileUpload/jquery.iframe-transport.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/scripts/jQuery.FileUpload/jquery.fileupload.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/scripts/jQuery.FileUpload/jquery.fileupload-ui.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/math.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/math.js")" type="text/javascript"></script>
    @*<script src="@Url.Content("~/Scripts/FormPage/_FormPageActions.js")" type="text/javascript"></script>*@

    <script src="@Url.Content("~/Scripts/angular.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/angular-route.js")" type="text/javascript"></script>
    <script src="../../Scripts/angular-route.min.js"></script>
    <script src="@Url.Content("~/Scripts/angular-ui-bootstrap-modal.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/registration-module.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/LiSimAngularControllers/ObjectPermmisions.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/LiSimAngularControllers/worklist-repository.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/LiSimAngularControllers/worklist-controller.js")" type="text/javascript"></script>

    @*<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>*@
    @*<link rel="stylesheet" id='camera-css'  media='all' type="text/css" href="@Url.Content("~/Content/camera.css")" />*@



    <link rel='stylesheet' id='camera-css'  href='@Url.Content("~/Content/camera.css")' type='text/css' media='all'>
    <style>
        .error {
            border: 1px solid rgba(215, 0, 0, 0.75);
            box-shadow: inset 0px 0px 2px 0px rgba(255, 0, 0, 0.75);
        }

        body {
            margin: 0;
            padding: 0;
        }


        a:hover {
            text-decoration: none;
        }

        #back_to_camera {
            clear: both;
            display: block;
            height: 80px;
            line-height: 40px;
            padding: 20px;
        }

        .fluid_container {
            max-width: 1000px;
            width: 90%;
        }
    </style>

    @*<script src="@Url.Content("~/Scripts/jquery.min.js")" type="text/javascript"></script>*@
    @*<script src="@Url.Content("~/Scripts/jquery.mobile.customized.min.js")" type="text/javascript"></script>*@
    <script src="@Url.Content("~/Scripts/jquery.easing.1.3.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/camera.min.js")" type="text/javascript"></script>
    <!--scripts menu desplegable-->
    <script type="text/javascript">
        $(document).ready(function () { // Script del Navegador
            $("ul.subnavegador").hide();
            $("a.desplegable").toggle(
              function () {
                  $(this).parent().find("ul.subnavegador").slideDown('fast');
              },
              function () {
                  $(this).parent().find("ul.subnavegador").slideUp('fast');
              }
            );
        });
    </script>
    <!--menu desplegable-->
    @RenderSection("HeadAssets", required: false)

</head>
<body>
    <div id="modalContents" title="Cargar Archivos" style="display: none;">
        <form id="formUploadFileForApproval" class="form" role="form">
            <div id="divFileUpload">
            </div>
            <div id="progress">
                <div class="bar" style="width: 0%;"></div>
            </div>
        </form>
    </div>
    <div id="container">
        <div id="caja">

            @Html.ActionLink("Contestar preguntas de seguridad", "Answer_Question", "Account", null, new { @class = "NewLink" }) / @Html.ActionLink("Cambiar contraseña", "ChangePassword", "Account") / <a href="#">Ayuda</a> /@Html.ActionLink("Cerrar sesión", "LogOff", "Account")
        </div>
        <header>
            <div id="header">
                <div id="izq">
                    <a href="">
                        <img src="@Url.Content("~/Content/images/Custom/Clientlogo2.jpg")" width="235" height="128" border="0"/></a>
                </div>
                <div id="animacion1">
                    <h1 id="bienvenida"><span class="txtnaranja txtbold">Bienvenido</span> @Session["GivenName"] <span class="txtazul txtbold">&Uacute;ltima fecha de ingreso:</span>@Session["LastLoginDate"]</h1>
                    <div id="logmensajes1">
                        @if (Session["AdCampaign"] != null)
                        {
                            <div class="fluid_container">
                                <div class="camera_wrap camera_magenta_skin" id="camera_wrap_2">
                                    @foreach (STPC.DynamicForms.Web.RT.Services.Entities.AdCampaign item in (List<STPC.DynamicForms.Web.RT.Services.Entities.AdCampaign>)Session["AdCampaign"])
                                    {
                                        string imageName = item.Image;						
                                        <div data-thumb='@imageName' data-src='@imageName'>
                                            <div class="camera_caption fadeFromBottom">
                                                @item.Text <em></em>
                                            </div>
                                        </div>
                                    }

                                </div>
                            </div>
                        }
                    </div>
                    <!--log mensajes-->
                </div>
            </div>
        </header>
        <!--<div id="header-wrapper">-->

        <!-- .fluid_container -->

        <!--<div style="clear: both; display: block; height: 10px"></div>-->


        <!--</div>-->

        <div class="clear"></div>
        <div id="content-wrapper">
            <div id="content">
                <div id="left-column">
                    @{                            
                        //Html.RenderAction("FormsMenu", "Home");
                        Html.RenderAction("FormsMenuAuth", "Home", userModel);
                    }
                </div>
                <div id="right-column">
                    @RenderBody()
                </div>
                <div class="clear"></div>
                <div id="footer">
                    <!--<img src="@Url.Content("~/Content/images/logo_pata.gif")" width="38" height="50" alt="Join" /><br />
                    Copyright © @DateTime.Now.Year - LiSim SAS-->
                </div>
            </div>
        </div>
        <div id="bottom">
        </div>
        <div id="footer1">
            <img src="@Url.Content("~/Content/images/Custom/ClientLogoBottom.jpg")" alt="Join" /><br />
            Copyright © @DateTime.Now.Year - Lilian Simbaqueba SAS<br />
            V. @typeof(STPC.DynamicForms.Web.RT.Controllers.AccountController).Assembly.GetName().Version.ToString(3)
        </div>

    </div>
    <div id="AnswerDialog" title="Preguntas de seguridad" style="display: none; width: 800px">
    </div>
</body>

@RenderSection("BottomAssets", required: false)
</html>
<script>
    function doUnloading() {

        $.getJSON("/Account/LogOff");
    }
    $(document).ready(function () {
        //function doUnloading() {

        //    $.getJSON("/Account/LogOff");
        //}
        //function ConfirmLeave() {
        //    return 'leave';
        //}
        //jQuery(document).bind('keydown', function (e) {
        //    if (e.key == "F5") {
        //        $(window).unbind("mouseover");
        //        $(window).unbind("mouseout");
        //        window.onunload = null;
        //        console.log('keydown')
        //    }
        //    else if (e.key.toUpperCase() == "W" && prevKey == "CONTROL") {
        //        window.onbeforeunload = ConfirmLeave;
        //        window.onunload = doUnloading;
        //        console("1");
        //    }
        //    else if (e.key.toUpperCase() == "R" && prevKey == "CONTROL") {
        //        window.onbeforeunload = ConfirmLeave;
        //        window.onunload = doUnloading;
        //        console("2");
        //    }
        //    else if (e.key.toUpperCase() == "F4" && (prevKey == "ALT" || prevKey == "CONTROL")) {
        //        window.onbeforeunload = ConfirmLeave;
        //        window.onunload = doUnloading;
        //        console("3");
        //    }
        //    prevKey = e.key.toUpperCase();

        //});
        //$(window).on('mouseover', (function () {
        //    window.onbeforeunload = null;
        //    if (navigator.userAgent.indexOf("Firefox") != -1)
        //    {
        //        window.onunload = null;
        //    }
        //}));
        //$(window).on('mouseout', (function () {
        //    console.log('mouseout')
        //    window.onbeforeunload = ConfirmLeave;
        //    window.onunload = doUnloading;
        //}));
        var objInstanceName = new jsNotifications({
            autoCloseTime: 5,
            showAlerts: true,
            title: 'Contraseña proxima a expirar'
        });

        //check the browser support
        if (objInstanceName.isAvailable()) {
            alert('error iexplorer');
            //show the bar to Chrome/Chromium users
            if (objInstanceName.getStatus() == 1) $('#divBottomBar').fadeIn(1200);
        }

        $.ajax({
            type: 'POST',
            url: '/Home/GetDaysToExpirePassword',
            dataType: 'json',
            success: function (nDias) {

                if (nDias != -1) {
                    objInstanceName.show('warning', 'Faltan ' + nDias + ' días para expirar la contraseña.', true);
                }
            },
            error: function (req, status, error) {
                alert("Error: " + error);
            }
        });

    });

    function ConfirmLeave() {
        return 'leave';
    }

    var prevKey = "";


    function doUnloading() {

        $.getJSON("/Account/LogOff");
    }

    $(document).ajaxStart(function () {
        var sessionTimeoutWarning =
    '@System.Configuration.ConfigurationSettings.AppSettings["SessionWarning"].ToString()';
        @{
            STPC.DynamicForms.Web.Common.CustomMembershipProvider provider = (STPC.DynamicForms.Web.Common.CustomMembershipProvider)Membership.Provider;
            }
        var sessionTimeout = '@provider.GetTimeOut()';
        if (sessionTimeoutWarning != undefined && sessionTimeout != undefined)
            setWarningTimeOut(sessionTimeoutWarning, sessionTimeout)
    });

    //$(document).ajaxComplete(function (event, xhr, settings) {
    //    console.log('event ' + event + ' xhr ' + xhr + 'settings ' + settings);
    //});
    $(document).ajaxError(function (event, request, settings) {
        console.log(request)
    });
    $(document).ajaxSuccess(function (event, xhr, settings) {

    });
    var count =@Session["counListCampaign"]

        jQuery(function () {
            if (count > 1) {
                jQuery('#camera_wrap_2').camera({
                    height: '150px',
                    thumbnails: false,
                    pagination: false,
                    autoAdvance: true
                });
            }
            else {
                if (count == 1) {
                    jQuery('#camera_wrap_2').camera({
                        height: '150px',
                        thumbnails: false,
                        pagination: false,
                        autoAdvance: false
                    });
                }

            }
        });



    $(function () {

        $('#AnswerDialog').dialog({
            autoOpen: false,
            width: 650,
            resizable: false,
            modal: true,
            buttons: {
                "Validar": function () {
                    if (comprobarCamposRequired()) {
                        $("#AnswerSecurityForm").submit();
                    } else {

                        alert('Rellene todos los campos');

                    }

                },
                "Cancelar": function () {
                    $(this).dialog("close");
                }
            }
        });

        $(".NewLink").click(function () {
            linkObj = $(this);
            var dialogDiv = $('#AnswerDialog');
            var viewUrl = linkObj.attr('href');

            $.get(viewUrl, function (data) {
                if (data.Success != false) {
                    dialogDiv.html(data);
                    var $form = $("#AnswerSecurityForm");
                    $form.unbind();
                    $form.data("validator", null);
                    $.validator.unobtrusive.parse(document);
                    $form.validate($form.data("unobtrusiveValidation").options);
                    dialogDiv.dialog('open');
                }
                else
                    if (data.ErrorMessage != "SessionError")
                        alert(data.ErrorMessage)
                    else {
                        alert("Sessión cerrada o usuario no logeado");
                        var urlSite = window.location.origin = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
                        location.href = urlSite + "/Home/Menu"

                    }
            });
            return false;
        });
    });

    function comprobarCamposRequired() {
        var correcto = true;
        var campos = $('input[type="text"]');
        var select = $('select:required');


        $(campos).each(function () {
            if ($(this).val() == '') {
                correcto = false;
                $(this).addClass('error');

                $(this).live('keyup', function () {
                    if ($(this).val() != "") {
                        $(this).removeClass('error');
                    }
                    else {
                        $(this).addClass('error');
                    }
                });
            }
        });
        $(select).each(function () {
            if ($(this).val() == '') {
                correcto = false;
                $(this).addClass('error');
            }
        });
        return correcto;
    }

    function updateSuccessQuestions(data) {

        if (data.Success != false) {
            alert("Proceso finalizado con éxito")
            $('#AnswerDialog').dialog("close");
        }
        else
            if (data.ErrorMessage != "SessionError")
                alert(data.ErrorMessage)
            else {
                alert("Sessión cerrada o usuario no logeado");
                var urlSite = window.location.origin = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
                location.href = urlSite + "/Home/Menu"

            }
    }

    function updateSuccessChangePassword(data) {
        if (data.Success != false) {
            var urlSite = window.location.origin = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
            location.href = urlSite + "/account/LogOff"
        }
        else {
            alert(data.ErrorMessage)
        }
    }


</script>

